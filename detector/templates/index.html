<!DOCTYPE html>
<head>
    <title>Potter</title>
    <!--<script src="{% url 'detector:sensors.js' %}"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>-->
</head>

<body>
    <h1>Is it a pothole?</h1>
    <div id='indicator'> {% pothole %} </div>

    <div id='values'>
        <!--
        <h3>Accelerometer</h3>
                        <h4>acc-X:</h4>
                        <input type="text" readonly id="x" value="" /><br>
                        <h4>acc-Y:</h4>
                        <input type="text" readonly id="y" value="" /><br>
                        <h4>acc-Z:</h4>
                        <input type="text" readonly id="z" value="" /><br>
        <h3>GyroScope</h3>
                        <h4>Alpha;:</h4>
                        <input type="text" readonly id="a" value="" /><br>
                        <h4>Gamma:</h4>
                        <input type="text" readonly id="g" value="" /><br>
                        <h4>Beta:</h4>
                        <input type="text" readonly id="b" value="" /><br>
    </div>

    <div id='buttons'>
        <button onclick='start()' id='send'> start </button>
        -->
    </div>

</body>




<!--Clientside script-->
<script>
window.addEventListener("devicemotion", accelerometer,True);
window.addEventListener('deviceorientation', orientation, True);

//var socket =io();

var x, y, z, alpha, gamma, beta;
arr = {'data':[]};
var isOn = false;
//Running always
function accelerometer(event){
    x = event.accelerationIncludingGravity.x;
    y = event.accelerationIncludingGravity.y;
    z = event.accelerationIncludingGravity.z;
}

function orientation(event){
    alpha = event.alpha;
    gamma = event.gamma;
    beta = event.beta;
}


//Start here
function start(){
    if (isOn){
    isOn = true;
    interval = setInterval(arraying, 200);
    document.querySelector("#send").innerHTML = 'stop'
    } else {
        clearInterval(interval);
        isOn = false;
        document.querySelector("#send").innerHTML = 'start'
    }
}

//Appending every 200 ms
function arraying(){
    arr['data'].push(x,y,z,alpha,gamma,beta);
    if(arr['data'].length >=30){
        send();
    }
}

//Sending to socket on views.py
function send(){
    //socket.emit('detect', arr);
    xhttp.open('POST', {% url detect %}, false);
    xhttp.send(arr);
    arr['data'].length = 0;
}

//Recieving from socket on views.py, displaying result in the HTML
socket.on('Result', res =>{
    document.querySelector('#indicator').innerHTML = res;
})

</script>